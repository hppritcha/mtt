# INI file for Cori

[MTTDefaults]
scratchdir = v4.1.x_scratch
description = OpenMPI master
platform = ANL-theta
executor = sequential
restart_file = /home/howardp/mtt/v4.1.x_scratch/ibm_installed_stage

[Profile:Installed]

#======================================================================
# Define some default launcher execution parameters
#======================================================================

[LauncherDefaults:OMPI]
#plugin = OpenMPI
plugin = ALPS
command = aprun
np = 16

skipped = 77
merge_stdout_stderr = 1
stdout_save_lines = 100
stderr_save_lines = 100

#======================================================================
# Test run phase - the executor will automatically change directory to
# the top directory where the tests were installed, so any search for
# executables will take place relative to that point
#======================================================================

[TestRun:IBMInstalledOMPI]
plugin = ALPS
#plugin = OpenMPI
parent = TestBuild:IBMInstalled
fail_timeout = 600
#test_dir = "collective, communicator, datatype, environment, group, info, io, pt2pt, random, topology"
test_dir = "collective,pt2pt"
checkpoint_file = /home/howardp/mtt/v4.1.x_scratch/ibm_run_stage
#test_dir = "communicator, datatype, environment, group, info, io, pt2pt, random, topology"
#max_num_tests = 300
stdout_save_lines = 100
stderr_save_lines = 100

# Tests that are supposed to fail
fail_tests = abort:3 final:1

# THREAD_MULTIPLE test will fail with the openib btl because it
# deactivates itself in the presence of THREAD_MULTIPLE.  So just skip
# it.  loop_child is the target for loop_spawn, so we don't need to
# run it (although it'll safely pass if you run it by itself).
skip_tests = allgather_gap_inter,allgather_inter,allgatherv_inter,allreduce_inter,alltoall_inter,alltoallv_inter,alltoallw_inter,barrier_inter,bcast_inter,gather_gap_inter,gather_inter,gatherv_gap_inter,gatherv_inter,iallgather_gap_inter,iallgather_inter,iallgatherv_gap_inter,iallgatherv_inter,iallreduce_inter,ialltoall_inter,ialltoallv_inter,ialltoallw_inter,ibarrier_inter,ibcast_inter,igather_gap_inter,igatherv_inter,ireduce_scatter_block_inter,init_thread_multiple,comm_split_f,scatterv_init_inter,scatter_init_inter,reduce_scatter_init_inter,reduce_scatter_block_init_inter,reduce_init_inter,gatherv_init_inter,gather_init_inter,bcast_init_inter,barrier_init_inter,alltoallw_init_inter,alltoallv_init_inter,alltoall_init_inter,allrecuce_init_inter,allgatherv_init_inter,allgather_init_inter,iscatterv_gap_inter,ireduce_inter,igatherv_gap_inter,allgatherv_gap_inter,igather_inter,ireduce_scatter_inter,iscatter_gap_inter,iscatter_inter,iscatterv_inter,reduce_inter,reduce_scatter_block_inter,reduce_scatter_inter,scatter_gap_inter,scatter_inter,scatterv_gap_inter,scatterv_inter

# Upped the time allocated to almost 4 hours because of the hanging test runs. 
# Normally 3 hours should be enough. 4 hours is the max allowed for a 
# --qos=interactive job on Cori.

#allocate_cmd = salloc -N 4 -C knl --qos=interactive --ntasks-per-node=4 --exclusive --time=03:59:00 --no-shell --job-name=testRunMaster
#deallocate_cmd = scancel --name testRunMaster
